<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>SCal</title>

      <!-- full calendar css link -->
      <link rel="stylesheet" href="bower_components/fullcalendar/dist/fullcalendar.css" />
      <link rel="stylesheet" src="assets/css/fullcalendar-custom.css" />

      <!-- jquery, moment, and angular have to get included before fullcalendar -->
      <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
      <script type="text/javascript" src="bower_components/moment/min/moment.min.js"></script>
      <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
      <script type="text/javascript" src="bower_components/angular-ui-calendar/src/calendar.js"></script>
      <script type="text/javascript" src="bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
      <script type="text/javascript" src="bower_components/fullcalendar/dist/gcal.js"></script>

      <!-- Other front end links -->
      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

      <!-- calendar front end javascript -->
      <script type="text/javascript" src="app/app.js"></script>

      <!-- Load all .js files here --><script type="text/javascript">
        $(function() {
            $("#sidebar").load("partials/sidebar.html");

            $.getScript("app/modal.js");
            
            $.get("/user/isLoggedIn", function(resp) {
                var scope = angular.element($('#bodyTagID')).scope();
                loadEvents(scope,resp);
            });

            function loadEvents(scope, resp)
            {
                if (JSON.parse(resp).success) {
                    $('#sidebarUser').html(JSON.parse(resp).username);
                    $.get("/calendar?view=all", function(data) {
                        if (JSON.parse(data).success) {
                            var events = JSON.parse(data).events;

                            for (var event in events) {
                                scope.addEvent(parseServerEvent(events[event]));
                            }

                            scope.renderCalendar();
                        }
                    });
                }
            }

            function parseServerEvent(event)
            {
                var result = event;
                result.title = result.name;
                result.start = result.start_time;
                result.end = result.end_time;
                result.stick = "true";
                delete result.name;
                delete result.start_time;
                delete result.end_time;

                return result;
            }
        });

    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/styles.css"></link>
    </head>
    <body ng-app="calendar" ng-controller="calendarCtrl" id="bodyTagID">
        <div class="container">

            <!-- Sidebar module --><!-- imported via jQuery load call -->
            <div id="sidebar"></div>

            <!-- My army of modals -->
            <div id="modal" class="modal"></div>

            <!-- Calendar module --><!-- This is handled by ui-calendar -->
            <div id="calendar" ui-calendar="uiConfig.calendar" ng-model="eventSources" calendar="appCalendar""></div>
        </div>
    </body>
</html>
